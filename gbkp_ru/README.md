# Набор скриптов резервного копирования для репозиториев Studio git (gbkp)
Этот скрипт bash автоматизирует процесс настройки оповещений по электронной почте и автоматического резервного копирования для устройства хранения.

**Функциональность:**

***Установщик***

* Позволяет устанавливать получателей электронной почты для уведомлений.
* Настраивает различные параметры для автоматического резервного копирования, такие как:
    * Имя USB-устройства
    * Префикс метки диска
    * Каталог резервного копирования
    * Частота резервного копирования (ежемесячно, еженедельно, ежедневно)
* Проверяет и проверяет адреса электронной почты перед продолжением.
* Устанавливает необходимое программное обеспечение, если его еще нет.
* Создает файл конфигурации (`gbkp.conf`) с указанными настройками.
* Обновляет задание cron для запуска скрипта резервного копирования.
* Настраивает параметры SMTP для оповещений по электронной почте.

***Основной скрипт***

Этот скрипт автоматизирует процесс резервирования Git-репозиториев на внешние диски и отправки электронных писем о результатах.

* Основные функции:
    * Автоматически монтирует и синхронизирует главный резервный диск с подключенными внешними дисками.
    * Записывает процесс и отправляет электронное письмо с результатами.
    * Отмонтирует внешние диски и предоставляет доступ к ним через SMB.
    * Отправляет электронное письмо, когда доступ завершен, и инструкрует о получении внешних дисков.

* **Как работает:**

1 Монтирование и синхронизация дисков:
    - Скрипт итерируется по подключенным дикам и монтирует их.
    - Он проверяет, является ли главный резервный диск不同 от текущего диска, и проскакивает его.
    - Для каждого подключенного диска он синхронизирует основной резервный диск с текущим дискм с помощью `rsync`.
2 Запись:
    - Скрипт записывает все действия и потенциальные ошибки или предупреждения в файл.
3 Доступ через SMB:
    - Скрипт модифицирует файл `smbd.conf`, чтобы делиться внешними дисками в只 lectura.
    - Он монтирует диски и добавляет их к `smbd.conf` файлу.
4 Отправка электронного сообщения:
    - Скрипт проверяет на наличие ошибок во время процесса и отправляет электронные сообщения в зависимости от этого.
    - Один notification отправляется после успешного резервирования, а другой - при обнаружении ошибок.
5 Отмонтирование и очистка:
    - После часа скрипт отмонтирует внешние диски и удаляет делится.
    - Он отправляет электронное письмо, напоминая пользователям о получении внешних дисков из безопасного места.

**Дополнительные замечания:**

* Скрипт требует прав root и использует определенные имена каталогов и конфигурационных файлов.
* Переменная `BKP_DIR` должна быть определена, чтобы указать каталог, где хранятся резервы.
* Переменная `EMAIL_TO` должна быть заполнена адресами электронных почт, чтобы получать уведомления.


**Возможности:**

* Включает тщательную проверку адресов электронной почты.
* Предоставляет обратную связь пользователю на протяжении всего процесса.
* Предлагает четкое подтверждение перед внесением изменений.

Прежде всего, получите список репозиториев, которые вы хотите создать.

Чтобы получить список репозиториев в формате .json, вам нужно использовать gitlab api:
- `https://your-gitlab-host/api/v4/projects`
Вы можете автоматизировать это, но я не вижу необходимости в этом шаге
- После этого вам нужно сохранить файл .json в каталоге, назвав его так:
- gbkp_YOUR-REPO-NAME.json, скрипт найдет его как `gbkp*.json`

Второй шаг - запустите скрипт установки от суперпользователя.
- `sudo ./install.sh`
- Если вы хотите изменить параметры - измените файл `/etc/gbkp.conf`
- Если вы хотите добавить список репозиториев к существующему - поместите новый файл в этот каталог и снова запустите скрипт установки с параметром `--add-json`
- Если вы хотите изменить список репозиториев - поместите новый файл в этот каталог и снова запустите скрипт установки с параметром `--new-json`
